{"version":3,"file":"cart.js","mappings":"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","sources":["webpack://itay-upsell-and-cart-plugin/./src/user/js/cart.js"],"sourcesContent":["class Cart {\r\n  #form;\r\n  #datePicker;\r\n  #timePicker;\r\n  #userTime;\r\n  #siteTimes;\r\n  #todaySelected;\r\n  #instantiated;\r\n  #timeReducer = 1;\r\n  #data = {\r\n    date: undefined,\r\n    time: undefined,\r\n  };\r\n  constructor() {\r\n    if (this.#instantiated) return;\r\n    jQuery(document.body).on(\"wc_fragments_refreshed\", () => {\r\n      this.initializeVariables();\r\n      this.events();\r\n    });\r\n  }\r\n  events() {\r\n    // form submit\r\n    this.#form.on(\"submit\", (e) => {\r\n      e.preventDefault();\r\n      this.submitForm();\r\n    });\r\n\r\n    // Date change\r\n    this.#datePicker.datepicker(\r\n      \"option\",\r\n      \"onSelect\",\r\n      function (dateText, inst) {\r\n        // update the date property.\r\n        this.#data.date = new Date(dateText).getDate();\r\n        const currentDate = new Date().getDate();\r\n        this.#todaySelected = this.#data.date == currentDate ? true : false;\r\n\r\n        // show time selector.\r\n        this.showTimeSelector();\r\n      }.bind(this)\r\n    );\r\n\r\n    //Time selected -- irrelevant\r\n    // this.#timePicker.change(function () {});\r\n  }\r\n\r\n  showTimeSelector() {\r\n    if (this.#timePicker.hasClass(\"hidden\")) {\r\n      this.#form.find(\"#arrival-time-label\").removeClass(\"hidden\");\r\n      this.#timePicker.removeClass(\"hidden\");\r\n    }\r\n    this.generateTimes();\r\n  }\r\n\r\n  generateTimes() {\r\n    this.#userTime = new Date().getTime();\r\n\r\n    this.#timePicker[0].innerHTML = \"\";\r\n\r\n    const newRestrictedTime =\r\n      this.#userTime - this.#timeReducer * (3600 * 1000);\r\n\r\n    const newUserTime = new Date(newRestrictedTime).toLocaleTimeString(\r\n      \"he-IL\",\r\n      {\r\n        hour12: false,\r\n        hour: \"2-digit\",\r\n        minute: \"2-digit\",\r\n      }\r\n    );\r\n\r\n    this.#userTime = newUserTime;\r\n\r\n    for (const [start, end] of Object.entries(this.#siteTimes)) {\r\n      if (this.#todaySelected) {\r\n        if (this.#userTime < start) {\r\n          this.#timePicker[0].innerHTML += `<option>${start}:${end}</option>`;\r\n        }\r\n      } else {\r\n        this.#timePicker[0].innerHTML += `<option>${start}:${end}</option>`;\r\n      }\r\n    }\r\n  }\r\n\r\n  submitForm() {\r\n    //rendering a spinner\r\n    const url = this.#form.attr(\"data-url\");\r\n    const data = {};\r\n    const formData = [...new FormData(this.#form[0])];\r\n\r\n    formData.forEach((element) => {\r\n      data[element[0]] = element[1];\r\n    });\r\n\r\n    this.renderSpinner();\r\n    jQuery.ajax({\r\n      type: \"POST\",\r\n      url: url,\r\n      data: data,\r\n      dataType: \"json\",\r\n      success: function (data, textStatus, jqXHR) {\r\n        // Process successful response.\r\n        this.showCart();\r\n      }.bind(this),\r\n      error: function (data, textStatus, jqXHR) {\r\n        //Process error response.\r\n        alert(\"An error has occured\\nPlease reload the page.\");\r\n      },\r\n    });\r\n  }\r\n\r\n  showCart() {\r\n    jQuery(\".iucp-address-container, .xoo-wsc-body, .xoo-wsc-footer\").each(\r\n      function () {\r\n        jQuery(this).toggleClass(\"hidden\");\r\n      }\r\n    );\r\n  }\r\n\r\n  renderSpinner() {\r\n    this.#form[0].innerHTML = \"<div class='lds-dual-ring'></div>\";\r\n  }\r\n\r\n  initializeVariables() {\r\n    this.#siteTimes = iucpTimes;\r\n\r\n    this.#form = jQuery(\"#iucp_form\");\r\n\r\n    this.#datePicker = jQuery(\"#iucp_datepicker\").datepicker({\r\n      dateFormat: \"mm-dd-yy\",\r\n      minDate: 0,\r\n      beforeShowDay: (date) => {\r\n        return [\r\n          date.getDay() == 0 ||\r\n            date.getDay() == 1 ||\r\n            date.getDay() == 2 ||\r\n            date.getDay() == 3 ||\r\n            date.getDay() == 4 ||\r\n            date.getDay() == 5,\r\n        ];\r\n      },\r\n      beforeShow: function (input, inst) {\r\n        const rect = input.getBoundingClientRect();\r\n        // use 'setTimeout' to prevent effect overridden by other scripts\r\n        setTimeout(function () {\r\n          const scrollTop = jQuery(\"body\").scrollTop();\r\n          inst.dpDiv.css({ top: rect.top + input.offsetHeight + scrollTop });\r\n        }, 0);\r\n      },\r\n    });\r\n\r\n    this.#timePicker = jQuery(\"#iucp_address_arrival_time\");\r\n  }\r\n}\r\n\r\n// Initialize the class.\r\nconst iucpCart = new Cart();\r\n"],"names":["Cart","form","datePicker","timePicker","userTime","siteTimes","todaySelected","instantiated","timeReducer","data","date","undefined","time","constructor","jQuery","document","body","on","initializeVariables","events","e","preventDefault","submitForm","datepicker","dateText","inst","Date","getDate","currentDate","showTimeSelector","bind","hasClass","find","removeClass","generateTimes","getTime","innerHTML","newRestrictedTime","newUserTime","toLocaleTimeString","hour12","hour","minute","start","end","Object","entries","url","attr","formData","FormData","forEach","element","renderSpinner","ajax","type","dataType","success","textStatus","jqXHR","showCart","error","alert","each","toggleClass","iucpTimes","dateFormat","minDate","beforeShowDay","getDay","beforeShow","input","rect","getBoundingClientRect","setTimeout","scrollTop","dpDiv","css","top","offsetHeight","iucpCart"],"sourceRoot":""}