{"version":3,"file":"cart.js","mappings":"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","sources":["webpack://itay-upsell-and-cart-plugin/./src/user/js/cart.js"],"sourcesContent":["class Cart {\r\n  #form;\r\n  #datePicker;\r\n  #timePicker;\r\n  #userTime;\r\n  #siteTimes;\r\n  #todaySelected;\r\n  #daySelected;\r\n  #instantiated;\r\n  #timeReducer = 1;\r\n  #data = {\r\n    date: undefined,\r\n    time: undefined,\r\n  };\r\n  constructor() {\r\n    if (this.#instantiated) return;\r\n    jQuery(document.body).on(\"wc_fragments_refreshed\", () => {\r\n      this.initializeVariables();\r\n      this.events();\r\n    });\r\n  }\r\n  events() {\r\n    // form submit\r\n    this.#form.on(\"submit\", (e) => {\r\n      e.preventDefault();\r\n      this.submitForm();\r\n    });\r\n\r\n    // Date change\r\n    this.#datePicker.datepicker(\r\n      \"option\",\r\n      \"onSelect\",\r\n      function (dateText, inst) {\r\n        // update the date property.\r\n        this.#data.date = new Date(dateText).getDate();\r\n        const currentDate = new Date().getDate();\r\n        this.#todaySelected = this.#data.date == currentDate ? true : false;\r\n\r\n        const days = [\r\n          \"sunday\",\r\n          \"monday\",\r\n          \"tuesday\",\r\n          \"wednesday\",\r\n          \"thursday\",\r\n          \"friday\",\r\n          \"saturday\",\r\n        ];\r\n\r\n        this.#daySelected =\r\n          days[jQuery(this.#datePicker).datepicker(\"getDate\").getDay()];\r\n\r\n        // show time selector.\r\n        this.showTimeSelector();\r\n      }.bind(this)\r\n    );\r\n\r\n    //Time selected -- irrelevant\r\n    // this.#timePicker.change(function () {});\r\n  }\r\n\r\n  showTimeSelector() {\r\n    if (this.#timePicker.hasClass(\"hidden\")) {\r\n      this.#form.find(\"#arrival-time-label\").removeClass(\"hidden\");\r\n      this.#timePicker.removeClass(\"hidden\");\r\n    }\r\n    this.generateTimes();\r\n  }\r\n\r\n  generateTimes() {\r\n    this.#userTime = new Date().getTime();\r\n\r\n    this.#timePicker[0].innerHTML = \"\";\r\n\r\n    const newRestrictedTime =\r\n      this.#userTime - this.#timeReducer * (3600 * 1000);\r\n\r\n    const newUserTime = new Date(newRestrictedTime).toLocaleTimeString(\r\n      \"he-IL\",\r\n      {\r\n        hour12: false,\r\n        hour: \"2-digit\",\r\n        minute: \"2-digit\",\r\n      }\r\n    );\r\n\r\n    this.#userTime = newUserTime;\r\n    console.log(this.#siteTimes);\r\n    let foundTimeZones = 0;\r\n    for (const [start, timeZoneData] of Object.entries(this.#siteTimes)) {\r\n      if (this.#todaySelected) {\r\n        if (this.#userTime < start) {\r\n          this.#timePicker[0].innerHTML += `<option>${start}:${timeZoneData.end_time}</option>`;\r\n        } else {\r\n          this.#timePicker[0].innerHTML = `<option>Deliveries on ${\r\n            this.#daySelected\r\n          } are over.</option>`;\r\n          return;\r\n        }\r\n      }\r\n      if (timeZoneData.days[this.#daySelected]) {\r\n        foundTimeZones++;\r\n        this.#timePicker[0].innerHTML += `<option>${start}:${timeZoneData.end_time}</option>`;\r\n      }\r\n    }\r\n    if (!foundTimeZones)\r\n      this.#timePicker[0].innerHTML = `<option>We are not doing deliveries on ${\r\n        this.#daySelected\r\n      }</option>`;\r\n  }\r\n  submitForm() {\r\n    //rendering a spinner\r\n    const url = this.#form.attr(\"data-url\");\r\n    const data = {};\r\n    const formData = [...new FormData(this.#form[0])];\r\n\r\n    formData.forEach((element) => {\r\n      data[element[0]] = element[1];\r\n    });\r\n\r\n    this.renderSpinner();\r\n    jQuery.ajax({\r\n      type: \"POST\",\r\n      url: url,\r\n      data: data,\r\n      dataType: \"json\",\r\n      success: function (data, textStatus, jqXHR) {\r\n        // Process successful response.\r\n        this.showCart();\r\n      }.bind(this),\r\n      error: function (data, textStatus, jqXHR) {\r\n        //Process error response.\r\n        alert(\"An error has occured\\nPlease reload the page.\");\r\n      },\r\n    });\r\n  }\r\n\r\n  showCart() {\r\n    jQuery(\".iucp-address-container, .xoo-wsc-body, .xoo-wsc-footer\").each(\r\n      function () {\r\n        jQuery(this).toggleClass(\"hidden\");\r\n      }\r\n    );\r\n  }\r\n\r\n  renderSpinner() {\r\n    this.#form[0].innerHTML = \"<div class='lds-dual-ring'></div>\";\r\n  }\r\n\r\n  initializeVariables() {\r\n    this.#siteTimes = iucpTimes;\r\n\r\n    this.#form = jQuery(\"#iucp_form\");\r\n\r\n    this.#datePicker = jQuery(\"#iucp_datepicker\").datepicker({\r\n      dateFormat: \"mm-dd-yy\",\r\n      minDate: 0,\r\n      firstDay: 0,\r\n      beforeShowDay: (date) => {\r\n        return [\r\n          date.getDay() == 0 ||\r\n            date.getDay() == 1 ||\r\n            date.getDay() == 2 ||\r\n            date.getDay() == 3 ||\r\n            date.getDay() == 4 ||\r\n            date.getDay() == 5 ||\r\n            date.getDay() == 6,\r\n        ];\r\n      },\r\n      beforeShow: function (input, inst) {\r\n        const rect = input.getBoundingClientRect();\r\n        // use 'setTimeout' to prevent effect overridden by other scripts\r\n        setTimeout(function () {\r\n          const scrollTop = jQuery(\"body\").scrollTop();\r\n          inst.dpDiv.css({ top: rect.top + input.offsetHeight + scrollTop });\r\n        }, 0);\r\n      },\r\n    });\r\n\r\n    this.#timePicker = jQuery(\"#iucp_address_arrival_time\");\r\n  }\r\n}\r\n\r\n// Initialize the class.\r\nconst iucpCart = new Cart();\r\n"],"names":["Cart","form","datePicker","timePicker","userTime","siteTimes","todaySelected","daySelected","instantiated","timeReducer","data","date","undefined","time","constructor","jQuery","document","body","on","initializeVariables","events","e","preventDefault","submitForm","datepicker","dateText","inst","Date","getDate","currentDate","days","getDay","showTimeSelector","bind","hasClass","find","removeClass","generateTimes","getTime","innerHTML","newRestrictedTime","newUserTime","toLocaleTimeString","hour12","hour","minute","console","log","foundTimeZones","start","timeZoneData","Object","entries","end_time","url","attr","formData","FormData","forEach","element","renderSpinner","ajax","type","dataType","success","textStatus","jqXHR","showCart","error","alert","each","toggleClass","iucpTimes","dateFormat","minDate","firstDay","beforeShowDay","beforeShow","input","rect","getBoundingClientRect","setTimeout","scrollTop","dpDiv","css","top","offsetHeight","iucpCart"],"sourceRoot":""}