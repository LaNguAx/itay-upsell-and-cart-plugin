{"version":3,"file":"cart.js","mappings":"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","sources":["webpack://itay-upsell-and-cart-plugin/./src/user/js/cart.js"],"sourcesContent":["class Cart {\r\n  #form;\r\n  #datePicker;\r\n  #timePicker;\r\n  #userTime;\r\n  #siteTimes;\r\n  #todaySelected;\r\n  #daySelected;\r\n  #daysFound = [];\r\n  #instantiated;\r\n  #timeReducer = 0;\r\n  #data = {\r\n    date: undefined,\r\n    time: undefined,\r\n  };\r\n  constructor() {\r\n    if (this.#instantiated) return;\r\n    jQuery(document.body).on(\"wc_fragments_refreshed\", () => {\r\n      this.initializeVariables();\r\n      this.events();\r\n    });\r\n  }\r\n  events() {\r\n    // form submit\r\n    this.#form.on(\"submit\", (e) => {\r\n      e.preventDefault();\r\n      this.submitForm();\r\n    });\r\n\r\n    // Date change\r\n    this.#datePicker.datepicker(\r\n      \"option\",\r\n      \"onSelect\",\r\n      function (dateText, inst) {\r\n        // update the date property.\r\n        this.#data.date = new Date(dateText).getDate();\r\n        const currentDate = new Date().getDate();\r\n        this.#todaySelected = this.#data.date == currentDate ? true : false;\r\n\r\n        const days = [\r\n          \"sunday\",\r\n          \"monday\",\r\n          \"tuesday\",\r\n          \"wednesday\",\r\n          \"thursday\",\r\n          \"friday\",\r\n          \"saturday\",\r\n        ];\r\n\r\n        this.#daySelected =\r\n          days[jQuery(this.#datePicker).datepicker(\"getDate\").getDay()];\r\n\r\n        // show time selector.\r\n        this.showTimeSelector();\r\n      }.bind(this)\r\n    );\r\n\r\n    //Time selected -- irrelevant\r\n    // this.#timePicker.change(function () {});\r\n  }\r\n\r\n  showTimeSelector() {\r\n    if (this.#timePicker.hasClass(\"hidden\")) {\r\n      this.#form.find(\"#arrival-time-label\").removeClass(\"hidden\");\r\n      this.#timePicker.removeClass(\"hidden\");\r\n    }\r\n    this.generateTimes();\r\n  }\r\n\r\n  generateTimes() {\r\n    this.#userTime = new Date().getTime();\r\n\r\n    this.#timePicker[0].innerHTML = \"\";\r\n\r\n    const newRestrictedTime =\r\n      this.#userTime - this.#timeReducer * (3600 * 1000);\r\n\r\n    const newUserTime = new Date(newRestrictedTime).toLocaleTimeString(\r\n      \"he-IL\",\r\n      {\r\n        hour12: false,\r\n        hour: \"2-digit\",\r\n        minute: \"2-digit\",\r\n      }\r\n    );\r\n\r\n    this.#userTime = newUserTime;\r\n\r\n    let foundTimeZones = 0;\r\n    let todayTimeZones = 0;\r\n\r\n    for (const [start, timeZoneData] of Object.entries(this.#siteTimes)) {\r\n      if (timeZoneData.days?.[this.#daySelected]) {\r\n        foundTimeZones++;\r\n        if (this.#todaySelected && this.#userTime < start) {\r\n          this.#timePicker[0].innerHTML += `<option>${start}:${timeZoneData.end_time}</option>`;\r\n          todayTimeZones++;\r\n        }\r\n        if (!this.#todaySelected) {\r\n          this.#timePicker[0].innerHTML += `<option>${start}:${timeZoneData.end_time}</option>`;\r\n        }\r\n      }\r\n    }\r\n\r\n    if (this.#todaySelected && !todayTimeZones) {\r\n      this.#timePicker[0].innerHTML = `<option>Deliveries on ${\r\n        this.#daySelected\r\n      } are over.</option>`;\r\n      return;\r\n    }\r\n    if (!foundTimeZones) {\r\n      this.#timePicker[0].innerHTML = `<option>We are not doing deliveries on ${\r\n        this.#daySelected\r\n      }</option>`;\r\n      return;\r\n    }\r\n  }\r\n  submitForm() {\r\n    //rendering a spinner\r\n    const url = this.#form.attr(\"data-url\");\r\n    const data = {};\r\n    const formData = [...new FormData(this.#form[0])];\r\n\r\n    formData.forEach((element) => {\r\n      data[element[0]] = element[1];\r\n    });\r\n\r\n    this.renderSpinner();\r\n    jQuery.ajax({\r\n      type: \"POST\",\r\n      url: url,\r\n      data: data,\r\n      dataType: \"json\",\r\n      success: function (data, textStatus, jqXHR) {\r\n        // Process successful response.\r\n        this.showCart();\r\n      }.bind(this),\r\n      error: function (data, textStatus, jqXHR) {\r\n        //Process error response.\r\n        alert(\"An error has occured\\nPlease reload the page.\");\r\n      },\r\n    });\r\n  }\r\n\r\n  showCart() {\r\n    jQuery(\".iucp-address-container, .xoo-wsc-body, .xoo-wsc-footer\").each(\r\n      function () {\r\n        jQuery(this).toggleClass(\"hidden\");\r\n      }\r\n    );\r\n  }\r\n\r\n  renderSpinner() {\r\n    this.#form[0].innerHTML = \"<div class='lds-dual-ring'></div>\";\r\n  }\r\n\r\n  initializeVariables() {\r\n    this.#siteTimes = iucpTimes;\r\n\r\n    this.#form = jQuery(\"#iucp_form\");\r\n\r\n    this.#datePicker = jQuery(\"#iucp_datepicker\").datepicker({\r\n      dateFormat: \"mm-dd-yy\",\r\n      minDate: 0,\r\n      firstDay: 0,\r\n      beforeShowDay: (date) => {\r\n        return [this.#daysFound.includes(date.getDay())];\r\n      },\r\n      beforeShow: function (input, inst) {\r\n        const rect = input.getBoundingClientRect();\r\n        // use 'setTimeout' to prevent effect overridden by other scripts\r\n        setTimeout(function () {\r\n          const scrollTop = jQuery(\"body\").scrollTop();\r\n          inst.dpDiv.css({ top: rect.top + input.offsetHeight + scrollTop });\r\n        }, 0);\r\n      },\r\n    });\r\n\r\n    this.#timePicker = jQuery(\"#iucp_address_arrival_time\");\r\n\r\n    const formatDays = [\r\n      \"sunday\",\r\n      \"monday\",\r\n      \"tuesday\",\r\n      \"wednesday\",\r\n      \"thursday\",\r\n      \"friday\",\r\n      \"saturday\",\r\n    ];\r\n    for (const [_start, timeZoneData] of Object.entries(this.#siteTimes)) {\r\n      if (timeZoneData?.days) {\r\n        for (const day of Object.keys(timeZoneData.days)) {\r\n          if (this.#daysFound.includes(formatDays.indexOf(day))) continue;\r\n          this.#daysFound.push(formatDays.indexOf(day));\r\n        }\r\n      }\r\n    }\r\n\r\n    this.#timeReducer = Number(iucpTimes.time_reducer);\r\n  }\r\n}\r\n\r\n// Initialize the class.\r\nconst iucpCart = new Cart();\r\n"],"names":["Cart","form","datePicker","timePicker","userTime","siteTimes","todaySelected","daySelected","daysFound","instantiated","timeReducer","data","date","undefined","time","constructor","jQuery","document","body","on","initializeVariables","events","e","preventDefault","submitForm","datepicker","dateText","inst","Date","getDate","currentDate","days","getDay","showTimeSelector","bind","hasClass","find","removeClass","generateTimes","getTime","innerHTML","newRestrictedTime","newUserTime","toLocaleTimeString","hour12","hour","minute","foundTimeZones","todayTimeZones","start","timeZoneData","Object","entries","end_time","url","attr","formData","FormData","forEach","element","renderSpinner","ajax","type","dataType","success","textStatus","jqXHR","showCart","error","alert","each","toggleClass","iucpTimes","dateFormat","minDate","firstDay","beforeShowDay","includes","beforeShow","input","rect","getBoundingClientRect","setTimeout","scrollTop","dpDiv","css","top","offsetHeight","formatDays","_start","day","keys","indexOf","push","Number","time_reducer","iucpCart"],"sourceRoot":""}